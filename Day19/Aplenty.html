<!DOCTYPE html>
<html lang="en">
<head>
    <title>Advent of Code 2023: Day 19 - Aplenty</title>
    <!-- General purpose functions here. -->
    <script>    
        // Write text to web page.
        function write(text) {
            let paragraph = document.createElement("p")
            paragraph.textContent = text
            document.body.appendChild(paragraph)
        }
        // Display a JSON object.
        function displayObject(object) {
            write(JSON.stringify(object, null, 2))
        }
        // Parse a part rating into an object.
        function parsePartRating(partRatingString) {
            let jsonPartRatingString = partRatingString
                .replace(/=/g, '":"')
                .replace(/{/g, '"')
                .replace(/}/g, '"')
                .replace(/,/g, '","')
            let partRating = JSON.parse(`{${jsonPartRatingString}}`)
            return partRating
        }
        // Parse a workflow into an object.
        function parseWorkflow(inputString) {
            const matches = inputString.match(/(\w+){(.*?)}/)
            if (matches && matches[1] && matches[2]) {
                const label = matches[1];
                const rulesArray = matches[2]
                    .split(',')
                    .map((ruleString, index, array) => {
                        const [key, value] = ruleString.split(':');
                        if (index === array.length - 1) {
                            return { "last": key }
                        } else {
                            return { [key]: value || null }
                        }
                    })
                return { [label]: rulesArray }
            }
            return null
        }        
        // Parse all input.
        function processInput(file, callback) {
            // Create a new FileReader
            var reader = new FileReader()
            // Define the callback for when the file is loaded
            reader.onload = function (event) {
                // Access the contents of the file
                var fileContent = event.target.result
                // Process the file content as needed
                const sections = fileContent.split('\n\n')
                const workflows = sections[0].split('\n').map(workflow => parseWorkflow(workflow))
                const partRatings = sections[1].split('\n').map(partRating => parsePartRating(partRating))
                // Call the provided callback with the results
                callback([workflows, partRatings])
            }
            // Read the file as text
            reader.readAsText(file)
        }
    </script>
</head>
<body>
    <H1>Advent of Code 2023 - Day 19 - Aplenty</H1><hr>
    <H2>Language: JavaScript</H2><hr>
    <H4>Please browse to the puzzle input: <input type="file" id="inputFile"/></H4>
    <script language = "javascript" type = "text/javascript">
        // Provide the ability for the user to select an input file.
        const inputFile = document.getElementById('inputFile')
        var workflows, partRatings
        inputFile.addEventListener('change', (event) => {
            selectedFile = event.target.files[0]
            if (selectedFile) {             
                // Parse input file.   
                write("Parsing input file...")
                processInput(selectedFile, function(results) {
                    workflows = results[0]
                    partRatings = results[1]
                    // Display inout data.
                    write("Workflows:")
                    workflows.forEach(workflow => displayObject(workflow))
                    write("PartRatings:");
                    partRatings.forEach(partRating => displayObject(partRating))                    
                })
            }
        })    
    </script>
</body>
</html>